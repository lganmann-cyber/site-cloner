<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Cloner - WordPress Migration Tool</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0f0f0f;
      color: #fff;
      min-height: 100vh;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    header {
      text-align: center;
      margin-bottom: 50px;
    }

    header h1 {
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    header p {
      color: #888;
      font-size: 1.1rem;
    }

    /* Steps indicator */
    .steps {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
    }

    .step-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #555;
      font-size: 0.9rem;
    }

    .step-indicator.active {
      color: #fff;
    }

    .step-indicator.completed {
      color: #22c55e;
    }

    .step-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: #222;
      border: 2px solid #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .step-indicator.active .step-number {
      background: #fff;
      color: #000;
      border-color: #fff;
    }

    .step-indicator.completed .step-number {
      background: #22c55e;
      border-color: #22c55e;
      color: #fff;
    }

    /* Main card */
    .card {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      padding: 40px;
    }

    /* Step 1: URL Input */
    .url-section {
      margin-bottom: 30px;
    }

    .url-section label {
      display: block;
      font-weight: 500;
      margin-bottom: 12px;
      font-size: 1rem;
    }

    .url-input-wrapper {
      display: flex;
      gap: 12px;
    }

    .url-input-wrapper input {
      flex: 1;
      padding: 16px 20px;
      font-size: 1rem;
      border: 1px solid #333;
      border-radius: 10px;
      background: #0f0f0f;
      color: #fff;
      outline: none;
      transition: border-color 0.2s;
    }

    .url-input-wrapper input:focus {
      border-color: #555;
    }

    .url-input-wrapper input::placeholder {
      color: #555;
    }

    /* Options */
    .options-section {
      margin-bottom: 30px;
    }

    .options-section h3 {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #0f0f0f;
      border: 1px solid #2a2a2a;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .option:hover {
      border-color: #444;
    }

    .option.selected {
      border-color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
    }

    .option input[type="checkbox"] {
      display: none;
    }

    .checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid #444;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .option.selected .checkbox {
      background: #22c55e;
      border-color: #22c55e;
    }

    .checkbox svg {
      width: 12px;
      height: 12px;
      stroke: #fff;
      opacity: 0;
    }

    .option.selected .checkbox svg {
      opacity: 1;
    }

    .option-text {
      font-size: 0.95rem;
    }

    /* Clone button */
    .clone-btn {
      width: 100%;
      padding: 18px;
      font-size: 1.1rem;
      font-weight: 600;
      background: #fff;
      color: #000;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .clone-btn:hover {
      background: #e5e5e5;
    }

    .clone-btn:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
    }

    /* Progress section (hidden by default) */
    .progress-section {
      display: none;
    }

    .progress-section.active {
      display: block;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .progress-header h3 {
      font-size: 1.1rem;
    }

    .progress-percent {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .progress-bar {
      height: 8px;
      background: #2a2a2a;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s;
    }

    .progress-log {
      background: #0f0f0f;
      border-radius: 10px;
      padding: 20px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.85rem;
    }

    .log-entry {
      padding: 6px 0;
      color: #888;
      border-bottom: 1px solid #1a1a1a;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-entry.success {
      color: #22c55e;
    }

    .log-entry.error {
      color: #ef4444;
    }

    .log-entry.current {
      color: #fff;
    }

    /* Results section (hidden by default) */
    .results-section {
      display: none;
    }

    .results-section.active {
      display: block;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background: #22c55e;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 24px;
    }

    .success-icon svg {
      width: 40px;
      height: 40px;
      stroke: #fff;
    }

    .results-title {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 8px;
    }

    .results-subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 30px;
    }

    .stat-box {
      background: #0f0f0f;
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .stat-number {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 0.8rem;
      color: #888;
    }

    .download-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .download-btn {
      flex: 1;
      padding: 16px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
      text-decoration: none;
    }

    .download-btn.primary {
      background: #fff;
      color: #000;
      border: none;
    }

    .download-btn.primary:hover {
      background: #e5e5e5;
    }

    .download-btn.secondary {
      background: transparent;
      color: #fff;
      border: 1px solid #333;
    }

    .download-btn.secondary:hover {
      border-color: #555;
    }

    /* Reset button */
    .reset-btn {
      display: block;
      margin: 20px auto 0;
      background: none;
      border: none;
      color: #888;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .reset-btn:hover {
      color: #fff;
    }

    /* Tutorial section - only on first page */
    .tutorial-section {
      margin-top: 36px;
      padding-top: 30px;
      border-top: 1px solid #2a2a2a;
    }

    .tutorial-title {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .tutorial-section video {
      width: 100%;
      max-height: 400px;
      border-radius: 10px;
      background: #0f0f0f;
    }

    /* Floating tutorial button - bottom right */
    .tutorial-float {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 20px;
      background: #22c55e;
      color: #fff;
      border: none;
      border-radius: 10px;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4);
      transition: all 0.2s;
      z-index: 1000;
    }

    .tutorial-float:hover {
      background: #16a34a;
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(34, 197, 94, 0.5);
    }

    .tutorial-float.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Site Cloner</h1>
      <p>Clone any website for WordPress migration</p>
    </header>

    <!-- Steps Indicator -->
    <div class="steps">
      <div class="step-indicator active" id="step1-indicator">
        <div class="step-number">1</div>
        <span>Enter URL</span>
      </div>
      <div class="step-indicator" id="step2-indicator">
        <div class="step-number">2</div>
        <span>Cloning</span>
      </div>
      <div class="step-indicator" id="step3-indicator">
        <div class="step-number">3</div>
        <span>Download</span>
      </div>
    </div>

    <div class="card">
      <!-- Step 1: Input Section -->
      <div id="input-section">
        <div class="url-section">
          <label for="url-input">Website URL</label>
          <div class="url-input-wrapper">
            <input type="url" id="url-input" placeholder="https://example.com" />
          </div>
        </div>

        <div class="options-section">
          <h3>What to Extract</h3>
          <div class="options-grid">
            <label class="option selected">
              <input type="checkbox" name="css" checked />
              <div class="checkbox">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <span class="option-text">CSS Styles</span>
            </label>
            <label class="option selected">
              <input type="checkbox" name="images" checked />
              <div class="checkbox">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <span class="option-text">Images</span>
            </label>
            <label class="option selected">
              <input type="checkbox" name="fonts" checked />
              <div class="checkbox">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <span class="option-text">Fonts</span>
            </label>
            <label class="option selected">
              <input type="checkbox" name="content" checked />
              <div class="checkbox">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                  <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
              </div>
              <span class="option-text">Content/Copy</span>
            </label>
          </div>
        </div>

        <button class="clone-btn" id="clone-btn">Clone Entire Website</button>

        <div class="tutorial-section" id="tutorial-section">
          <h3 class="tutorial-title">How it works</h3>
          <video id="tutorial-video" controls preload="metadata" poster="">
            <source src="/assets/clone-tutorial.mp4" type="video/mp4">
            Your browser does not support the video tag.
          </video>
        </div>
      </div>

      <!-- Step 2: Progress Section -->
      <div class="progress-section" id="progress-section">
        <div class="progress-header">
          <h3>Cloning in progress...</h3>
          <span class="progress-percent" id="progress-percent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-log" id="progress-log">
          <div class="log-entry current">Starting clone process...</div>
        </div>
      </div>

      <!-- Step 3: Results Section -->
      <div class="results-section" id="results-section">
        <div class="success-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <h2 class="results-title">Clone Complete!</h2>
        <p class="results-subtitle" id="results-url">example.com</p>

        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-number" id="stat-pages">1</div>
            <div class="stat-label">Pages</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="stat-images">24</div>
            <div class="stat-label">Images</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="stat-fonts">4</div>
            <div class="stat-label">Fonts</div>
          </div>
          <div class="stat-box">
            <div class="stat-number" id="stat-css">1</div>
            <div class="stat-label">CSS File</div>
          </div>
        </div>

        <div class="download-buttons">
          <a href="#" class="download-btn primary" id="download-wp">Download WordPress Theme</a>
          <a href="#" class="download-btn secondary" id="download-all">Download All Files</a>
          <a href="#" class="download-btn secondary" id="download-css">Download CSS Only</a>
        </div>

        <button class="reset-btn" id="reset-btn">‚Üê Clone another site</button>
      </div>
    </div>
  </div>

  <button class="tutorial-float" id="tutorial-float">Need a tutorial?</button>

  <script>
    // DOM Elements
    const urlInput = document.getElementById('url-input');
    const cloneBtn = document.getElementById('clone-btn');
    const inputSection = document.getElementById('input-section');
    const progressSection = document.getElementById('progress-section');
    const resultsSection = document.getElementById('results-section');
    const progressFill = document.getElementById('progress-fill');
    const progressPercent = document.getElementById('progress-percent');
    const progressLog = document.getElementById('progress-log');
    const resetBtn = document.getElementById('reset-btn');
    const downloadWp = document.getElementById('download-wp');
    const downloadAll = document.getElementById('download-all');
    const downloadCss = document.getElementById('download-css');

    // Step indicators
    const step1 = document.getElementById('step1-indicator');
    const step2 = document.getElementById('step2-indicator');
    const step3 = document.getElementById('step3-indicator');

    // Options toggle
    document.querySelectorAll('.option').forEach(option => {
      option.addEventListener('click', () => {
        option.classList.toggle('selected');
        const checkbox = option.querySelector('input');
        checkbox.checked = option.classList.contains('selected');
      });
    });

    // Clone button click
    cloneBtn.addEventListener('click', async () => {
      const url = urlInput.value.trim();
      if (!url) {
        urlInput.focus();
        return;
      }

      const options = {
        css: document.querySelector('input[name="css"]').checked,
        images: document.querySelector('input[name="images"]').checked,
        fonts: document.querySelector('input[name="fonts"]').checked,
        content: document.querySelector('input[name="content"]').checked
      };

      inputSection.style.display = 'none';
      tutorialFloat.classList.add('hidden');
      progressSection.classList.add('active');
      step1.classList.remove('active');
      step1.classList.add('completed');
      step2.classList.add('active');
      cloneBtn.disabled = true;

      try {
        await startCloning(url, options);
      } catch (error) {
        addLogEntry('Error: ' + error.message, 'error');
        cloneBtn.disabled = false;
      }
    });

    async function startCloning(url, options) {
      progressLog.innerHTML = '';
      addLogEntry('Starting clone...', 'current');

      const res = await fetch('/api/clone', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ url, options })
      });

      if (!res.ok) {
        const err = await res.json().catch(() => ({}));
        throw new Error(err.error || 'Failed to start clone');
      }

      const { jobId } = await res.json();
      let lastLogLength = 0;

      const pollStatus = async () => {
        const statusRes = await fetch(`/api/status/${jobId}`);
        const data = await statusRes.json();

        progressFill.style.width = data.progress + '%';
        progressPercent.textContent = data.progress + '%';

        if (data.log && data.log.length > lastLogLength) {
          for (let i = lastLogLength; i < data.log.length; i++) {
            const type = i === data.log.length - 1 && data.status === 'in_progress' ? 'current' : 'success';
            addLogEntry(data.log[i], type);
          }
          lastLogLength = data.log.length;
        }

        if (data.status === 'completed') {
          showResults({
            url,
            pages: data.stats?.pages || 0,
            images: data.stats?.images || 0,
            fonts: data.stats?.fonts || 0,
            css: data.stats?.cssFiles || 1
          });
          downloadWp.href = `/api/download/${jobId}/wordpress`;
          downloadAll.href = `/api/download/${jobId}/all`;
          downloadCss.href = `/api/download/${jobId}/css`;
          cloneBtn.disabled = false;
          return;
        }

        if (data.status === 'error') {
          addLogEntry(data.error || 'Clone failed', 'error');
          cloneBtn.disabled = false;
          inputSection.style.display = 'block';
          return;
        }

        setTimeout(pollStatus, 500);
      };

      await pollStatus();
    }

    function addLogEntry(message, type = '') {
      document.querySelectorAll('.log-entry.current').forEach(el => {
        el.classList.remove('current');
      });

      const entry = document.createElement('div');
      entry.className = 'log-entry ' + type;
      entry.textContent = '> ' + message;
      progressLog.appendChild(entry);
      progressLog.scrollTop = progressLog.scrollHeight;
    }

    function showResults(data) {
      progressSection.classList.remove('active');
      resultsSection.classList.add('active');
      step2.classList.remove('active');
      step2.classList.add('completed');
      step3.classList.add('active');

      try {
        document.getElementById('results-url').textContent = new URL(data.url).hostname;
      } catch {
        document.getElementById('results-url').textContent = data.url;
      }
      document.getElementById('stat-pages').textContent = data.pages;
      document.getElementById('stat-images').textContent = data.images;
      document.getElementById('stat-fonts').textContent = data.fonts;
      document.getElementById('stat-css').textContent = data.css;
    }

    resetBtn.addEventListener('click', () => {
      resultsSection.classList.remove('active');
      progressSection.classList.remove('active');
      inputSection.style.display = 'block';

      step1.classList.add('active');
      step1.classList.remove('completed');
      step2.classList.remove('active', 'completed');
      step3.classList.remove('active', 'completed');

      progressLog.innerHTML = '<div class="log-entry current">Starting clone process...</div>';
      progressFill.style.width = '0%';
      progressPercent.textContent = '0%';
      urlInput.value = '';
      downloadWp.href = '#';
      downloadAll.href = '#';
      downloadCss.href = '#';
      cloneBtn.disabled = false;

      document.getElementById('tutorial-float').classList.remove('hidden');
    });

    // Tutorial float button - scroll to video, only show on first page
    const tutorialFloat = document.getElementById('tutorial-float');
    const tutorialSection = document.getElementById('tutorial-section');

    tutorialFloat.addEventListener('click', () => {
      tutorialSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    // Hide tutorial button when not on first page (backup for error/reset flows)
    const observer = new MutationObserver(() => {
      const onFirstPage = inputSection.style.display !== 'none';
      tutorialFloat.classList.toggle('hidden', !onFirstPage);
    });
    observer.observe(inputSection, { attributes: true, attributeFilter: ['style'] });
  </script>
</body>
</html>
